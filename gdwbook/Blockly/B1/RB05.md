# RB05 呼吸灯

## 课程概述

- 课程名称：见标题
- 课程时长：40 分钟 × 2
- 课程内容：利用 PWM 控制灯光强弱，实现呼吸灯效果
- 学生群体：3~6 年级

```plain
本课内容参考来源：
1. 《树莓派初级课程V1（吴俊杰老师18课时）》第 4 课
2. 课件 1.0 初级 1，第 05 课 
3. 酌情增删调整
```

## 教学目标

### 考察点

- 呼吸灯的概念
- PWM 的意义

### 知识与技能

- 呼吸灯的概念
- PWM 和 GPIO
- 带参数控制的循环
- 简单的函数封装

### 情感价值和学科交叉

- 视觉和频率的体验
- 初步体验数字信号和模拟信号

### 难点和注意事项

注意：由于经常拔插可能会导致 5，6，12，16 号口无法准确响应高频闪烁，在制作模拟 PWM 的步骤时可能会出现肉眼可见的闪灯而不是明暗变化。出现这种情况时可以尝试用其他 GPIO 口或更换扩展板解决。

## 教学准备

- 按教学准备基础要求进行准备
- 其它准备工作：需要延长线（杜邦线）连接 GPIO 和 LED

## 课堂教学活动


### 暖场（10分钟）

活跃气氛，复习上节课内容，引入本节课主题

复习：

- 红绿灯的实现

### 课堂讲解：呼吸灯 （50分钟）

**教学提纲：**

- 前篇
    - PWM 的 LED 亮度
    - 任务一：慢慢变亮的呼吸灯
    - 简单的函数封装
    - 任务二：慢慢变暗的呼吸灯
- 后篇
    - 任务三：使用 PWM 控制呼吸灯
    - 任务四：连续平滑呼吸的灯
- 扩展内容 *（根据学生程度酌情加入，不影响主线课程进度）*
    - 频率；人眼能够识别的闪烁频率
    - 电影播放的帧率 
    - 数字信号和模拟信号

### 巩固练习和作业（20 分钟）

扩展练习和作业。以下练习非主线任务，可根据整体或个别学生学习情况酌情选择作为课堂巩固练习或课后作业。课堂练习可分为2~3人小组进行讨论合作：

1. 尝试改变周期、改变渐变的间隔实现不同的效果
2. 尝试控制多个灯的呼吸；多个灯交错的呼吸；
3. 尝试实现流水呼吸灯；
4. 呼吸灯与蜂鸣器的联合变化。

**授课内容**：详见下文“讲义”部分。

## 讲义 *(完整授课内容和补充知识)*

### 灯的亮度调节

<div align="center">
    <img src="/media/15574583021836.jpg">
</div>

练习：

- 时间调短试试看
- 亮、灭时间变化试试看
- 人对亮、灭的感觉一样吗？

快到一定程度，人眼是无法分辨“闪烁”的

通过控制高频闪烁中“亮”“灭”所占时长比例的不同，达到控制亮度的目的。

呼吸灯：灯慢慢到最亮，然后慢慢变暗的灯。
灯的亮度超出一定范围，肉眼无法觉察亮度变化。

怎么实现呼吸灯效果？

### 任务一：慢慢变亮的灯

<div align="center">
    <img src="/media/15575446472553.jpg">
</div>

### 将控制亮度的过程封装为函数

如果代码中出现了大量重复的部分，就可以用函数来简化代码，使代码可读性和可维护性更强。

上一步堆积的大量积木，可以用这样的方式简化：

<div align="center">
    <img src="/media/15574900618990.jpg">
</div>

### 任务二：慢慢变暗的灯

利用封装函数制作慢慢变暗的灯以及变亮再变暗的灯。

### 任务三：通过 PWM 来实现呼吸灯

什么是 PWM：

<div align="center">
    <img src="/media/15574583648312.jpg">
</div>

PWM就是我们信号的占空比（比如我们这里信号是0-3000，那么300就是10%）
刚才通过亮灯时间来实现的呼吸灯，实际上就模拟了 PWM。

古德微平台提供了已经封装好的 PWM 控制。

基本的使用：

<div align="center">
    <img src="/media/15574907269747.jpg">
</div>

注意使用完 PWM 后要关停。

<div align="center">
    <img src="/media/15575454109478.jpg">
</div>

简单的函数封装后实现不断呼吸

<div align="center">
    <img src="/media/15575455576224.jpg">
</div>

### 任务四：连续平滑呼吸的呼吸灯

使用带参数循环来使灯连续变暗或变量
使用嵌套的循环来反复明暗

<div align="center">
    <img src="/media/15575458759807.jpg">
</div>

## 课件

根据本教学计划和讲义，以及具体授课对象编写。

文件名应为：

`RB05-呼吸灯.pptx`

